# Plane Trax 

### About the project
Uses ADS-B data transmitted from aircraft to generate a count of takeoffs and landings (operations) at a given airport.
 
This uses data from an ADS-B receiver located near the airport and is designed to be
executed on the same Raspberry Pi as the receiver.
 
The aircraft position messages generated by dump1090 and dump978 are read by planetrax.php using json files on the Raspberry Pi configured as the receiver.

It is determined whether the aircraft position, heading, and altitude represent a takeoff or landing for a given runway at a given airport.

Since multiple messages will be received from dump1090 and dump978 for each takeoff and landing sequence, it is determined whether an operation has already been logged for this sequence or if this is a duplicate.  If not a duplicate, an entry is written to the ops table in the database.
 
Optionally, log entries are written to the ops_log table in the database for all aircraft within a defined area.  This is used for debugging purposes.

Determining the latitude / longitude limits for each runway for the airport is a key requirement for the logging to function accurately.  

See the included file "install.docx" for installation instructions.

Installation Note: These instructions were compiled as the first installation was made and have not been tested.  Inconsistencies will likely be found in those using them.  Please E-Mail info@planetrax.com with any corrections.

### Prerequisites
1. An ADS-B receiver near the airport to be tracked.  This should be running on a Raspberry pi with dump1090 and / or dump978 installed.  This was tested on ADS-B Exchange build 8.2.220910 executing on a Raspberry Pi 4 but will likely work with other feeders.  See https://www.adsbexchange.com/share-your-data/adsbx-custom-pi-image/#google_vignette for installation instructions.

2. PHP v7.4.33 or later

3. php7.4-mysql

4. MariaDB 10.5.23 or later

5. Web server - This was tested with lighttpd but others should work as well.

### Determining Latitude / Longitude Settings for Runways
Making sure the minimum / maximum latitude and longitude are set correctly is a key factor in accurately identifying aircraft takeoffs and landings.  See the included file, airport.jpg, as an example.

Two boxes are created using min / max latitude and longitude.  Note that because the boxes end up being oriented to lines of latitude and longitude, they aren’t square to the runway unless the runway is either 18 / 36 or 09 / 27.

The boxes should be about ¾ mile wide and 1 mile long with the long side as close to parallel to the runway as possible.

The boxes shouldn’t include any of the runway area.  If so, duplicate landing / takeoff operations will be logged.

See the attached “airport.jpg” as an example with the boxes plotted.  The runways for this airport are 16 and 34.  

In the planetrax_sample.conf file, the “a” coordinates are the runway 16 approach area / runway 34 departure area.   The “b” coordinates are the runway 34 approach area / runway 16 departure area.

The boxes shouldn’t include any of the runway itself.  If so, duplicate landing / takeoff operations will be logged.


### Installation

### Web Server
  1. sudo chmod /var/www/ 777 -R
 	2. Will allow user ‘pi’ to write files
	3. md /var/www/html/planetrax
	4. chmod 777 /var/www/html/planetrax
 	5. cp stats.php /var/www/html/planetrax/stats.php
 

e.	cp db_constants_pi.php  /var/www/html/planetrax/db_constants.php


2.	Database Server
a.	sudo apt install mariadb-server

b.	sudo apt-get install php7.4-mysql

c.	Set user permissions
i.	sudo mysql
ii.	create user ‘pi’@’%’ identified by ‘adsb123’;
iii.	GRANT ALL PRIVILEGES ON *.* TO 'pi'@'%';

d.	Create database and tables
i.	mysql -upi -padsb123
ii.	Create database planetrax
iii.	Create table using create_table_ops.sql
iv.	Create table using create_table_ops_log.sql

e.	Enable remote access
i.	cd /etc/mysql/mariadb.conf.d
ii.	sudo nano 50-server.conf
iii.	Change the bind address from 127.0.0.1 to 0.0.0.0
iv.	Sudo service mariadb restart

3.	Plane Trax
a.	Configuration
i.	sudo cp  planetrax_sample.conf /etc/planetrax.conf

ii.	sudo nano planetrax.conf and set lat / lon parameters

iii.	sudo chmod 777 /etc/planetrax.conf

b.	md /usr/local/planetrax
i.	chmod 777 /usr/local/planetrax

c.	cp planetrax.php /usr/local/planetrax/planetrax.php
i.	chmod 777 /usr/local/planetrax/planetrax.php

d.	cp db_constants.php  /usr/local/planetrax/db_constants.php
i.	chmod 777 /usr/local/planetrax/db_constants.php

4.	Service 
a.	cp planetrax.service to /etc/systemd/system/planetrax.service

b.	sudo chmod 644 /etc/systemd/system/planetrax.service

c.	sudo systemctl enable planetrax.service

d.	sudo systemctl start planetrax.service

e.	sudo systemctl status planetrax.service

f.	sudo strace -e write -s 999 -p <id from status command>

5.	Test
a.	php /var/www/html/planetrax/stats.php

b.	From web browser on local network
i.	http://<ip of pi>/planetrax/stats.php


